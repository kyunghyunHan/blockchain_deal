# 블록체인 거래 이론

## 비트코인 거래 생성
![1525413286024-1](https://user-images.githubusercontent.com/88940298/147848166-35ca312c-ccea-4444-9064-db42bd2a6b43.png)

A 가 B에게 1코인을 주는 거래가 발생햇다고 가정
이것은 의사 표현만 한것이지 실제로 가치가 이동하지 않은 단계
ex)비트코인 거래는 거래를 생성하는 사람과 거래서명을 하는 사람이 같을 필요는 없다.즉  수표거래와 비슷하다고 생각하면 댐 
![1525413530445-2](https://user-images.githubusercontent.com/88940298/147848188-4864595d-d38b-4a80-82f7-25986e9a05e1.png)

## 비트코인 거래 서명
![1525413732971-pc_Group 3](https://user-images.githubusercontent.com/88940298/147848190-4edbf0f2-2c49-4e83-9e1d-5cf55e8c674d.png)

비트코인 거래가 생성되면 누가 거래를 생성했든,자금원의 소유자가 해당 거래에 대한 서명을 해야한다.서명이 완료되면 비로서 이거래의 거래가 유효해진다 , 그리고 비트코인 송금에 필요한 모든 정보가 담겨잇는 거래정보가 생겨난다.A가 B에게 1코인을 보낸다 는 내용이 적혀 있는 수표가 생겨난것과 비슷
## 비트코인 거래 정보 전송
A가 B에게 1코인을 보낸다 라는 내용이 담긴 거래정보를 A 와 B둘만 알고 있어서는 거래가 성사 될수 없다. 이 거래 정보는 비트코인 네트워크에 전송되어야 한다.수많은 노드중 하나에 이거래 정보가 도달해야 한다는 이야기이다

#### 정보를 제공할떄 상대방에 대한 신뢰가 없어도 가능한 3가지
![1525413860695-pc_Group 4](https://user-images.githubusercontent.com/88940298/147848192-95ee1501-1682-49e7-82ae-e88111487742.png)

- 블록체인에서 거래정보가 입력되다는 것은 단순히 스크립트가 네트워크상에 업로드 되는 것이고 이것 역시 암호화된 상태로 입력된다
- 기밀정보, 개인키, 인정서를 포함되자 않기 떄문에 공개적으로 전송이 가능하다.기밀정보를 포함되자 않는 거래정보를 공유 하는 것이다.거래정보가 하나의 노드에 도달하기만 하면 전세계 사람들 누구나 열람이 가능한 OPEN SOURCE 가 될수 있는이유가 바로 여기에 있다.
- 비트코인 소비자들과 채굴자들은 비트코인에 부여된 가치가 떨어지면 스스로가 손해다.떄문에 좋은 방향으로 합의를 보려고 하는 경제적 유인도 있다


## 비트코인 거래정보 전파
![1525414211801-pc_Group 6](https://user-images.githubusercontent.com/88940298/147848198-a7c6ff02-b2cb-47ab-b5bf-3ab8541b7f86.png)

거래정보가 일단 하나에 노드에 도달하면 이노드는 비트코인 네트워크 상에 있는 모든 노드에게 이거래 정보를 전파해야한다.비트코인 네트워크는 P2P를 기반으로 하기 떄문에 모든 노드는 동등한 지위를 가지고 있고,정보 하나를 수천개의 노드에 전파하는데 불과 몇초도 걸리지 않는다
비트코인 거래정보가 안전하게 남을수 있는 이유가 바로 여기에 있다 이렇게 각각의 노드들이 거래를 유효화 하고 각자가 정보 전달의 시발점이 되는 역홯을 하기때문에 공격자가 들어오더라도 어느곳을 공격할지 알 수 없게 되는 것이다.

## 비트코인 거래 완료

이렇게 전파되는 과정에서 이 거래정보가 손상되지 않은 데이터인지 채굴 노드들에 의해 검증되면 비로소 이 거래정보가 영구적으로 블록에 기록된다. 이제 진짜로 A가B에게 1코인을 전송햇다고 할수 있는 것이다. 이렇게 기록된 정보는 이후에 위조,혹은 변조하는 것이 불가능하다

## A의 계좌에서 B의 계좌로 돈이 이동하는 과정
보낼 금액에 몇 코인을 보낼지 입력하는 입력값을 넣으면,해당 입력값에 대응하는 지갑 주소에서 몇 BTC를 나타내는 출력값이 생긴다 이 출력값은 블록에 기록된다.즉 이 출력값이 지갑에 찍히는 잔액덩어리 인셈이다
- 블록에 있는 비트코인의 구성은 소비되지 않은 거래의 출력값(UTXO)로 구성된다.
## 비트코인 잔액 "UTXO"
![1525414241169-pc_Group 7](https://user-images.githubusercontent.com/88940298/147848208-ef3c77a6-8ac9-4685-82c0-ce7e9b557822.png)

- 각 지갑의 UTXO들은 해당 지갑 주인마다 다르게 암호화 되어 있고,이 암호화된 UTXO는 블록체인 상에서 해당 UTXO의 주인을 인식하고 있는 전체 블록체인
![1525414252951-pc_Group 8](https://user-images.githubusercontent.com/88940298/147848217-e11820f1-9b56-4304-ab6b-815965731e50.png)

- A와 B가 C에게 각각 5코인,1코인을 송급했고,내역들은 모두 블록에 기록됐다고 가정하자
그러면 C에게 생기는 UTXO는 A가 입력한 5코인 입력값에대한 출력값 하나와 B가 입력한 1코인 입력값에 대한 출력값 하나 총 2개의 출력값이 생성
![1525414275437-pc_Group 9](https://user-images.githubusercontent.com/88940298/147848219-e7764080-c5b7-4860-94da-32295ef3afa0.png)

- D가 A,B,C로부터 2코인,9코인,1코인을 받아서 3개의 UTXO를 출력값으로 갖게 되었다.D가 E에게 8코인 전송 ,이렇게 되면 UTXO의 수는 5개에서 6개로 증가 UTXO를 하나의 동전이나 지폐로 보면된다.만원짜리 지폐를 찢어서 사용할수 없는 UXTO는 쪼개서 사용할 수 없다.대신 사용 가능한 UTXO를 지갑에서 찾아 입력값에 넣은 다음 출력값으로 잔액을 되돌려 받는 형식이다.
- 만일 전 C가 E에게 전송하려면 가진 UTXO데이터중 8코인을 전송 할 수 있는 데이터가 없기 떄문에 입력값에 대하여 ERROR값을 리턴한다
![1525414300641-pc_Group 10](https://user-images.githubusercontent.com/88940298/147848223-f6c98f30-a6a4-4010-8956-65f38b3ee790.png)

